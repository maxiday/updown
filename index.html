<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="referrer" content="always">
    <meta name="format-detection" content="telephone=no,address=no,email=no">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
    <!-- Summary -->
    <meta property="og:title" content="Play Up&Down">
    <meta property="og:description" content="Play Up&Down game">
    <!-- Title -->
    <title>Play Up&amp;Down</title>
    <!-- Css -->
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
<style>
.start_a {position:fixed; top:0%; left:0%; padding:60px 10px 0; width:100%; height:100%; text-align:center; border:3px solid #333; box-sizing:border-box;}
.start_a h1 {letter-spacing:-2px; font-size:40px; font-weight:bold;}
.start_a h1 i {font-size:30px;}
.start_a ul {margin:30px 0 0;}
.start_a ul,
.start_a ul li {line-height:24px; color:#666; font-size:16px; list-style:none;}
.start_a select {margin:20px auto 0; padding:0 15px; width:80%; max-width:300px; height:50px; color:#444; font-size:22px; text-align:center;}
.start_a input {display:block; margin:20px auto 20px; padding:0 10px; width:80%; max-width:300px; height:56px; line-height:56px; font-size:22px; text-align:center; border:2px solid #999; box-sizing:border-box;}
.game_a {position:fixed; top:-100%; left:0; padding:60px 10px 0; width:100%; height:100%; background:#fff; border:3px solid #333; box-sizing:border-box;}
.game_a > div {margin:0 auto; width:50%; min-width:260px;}
.game_a .summary {position:relative; margin-top:30px; font-size:20px; text-align:center;}
.game_a .feed {margin:0 auto; padding:20px; width:80px; height:80px; line-height:80px; text-align:center; background:#fff; opacity:0.9; border-radius:50em; border:2px solid red;}
.game_a .feed i {color:red; font-size:60px; vertical-align:middle;}
.game_a input {display:block; margin:30px auto 20px; padding:0 10px; width:80%; max-width:300px; height:56px; line-height:56px; font-size:22px; text-align:center; border:2px solid #999; box-sizing:border-box;}
.game_a .btn_close {position:absolute; top:15px; right:15px; width:34px; height:34px;}
.game_a .btn_close span {display:block; position:absolute; top:50%; transform:translateY(-50%); width:100%; height:3px; background:#444;}
.game_a .btn_close span:first-child {transform:rotate(-45deg);}
.game_a .btn_close span:last-child {transform:rotate(45deg);}
.game_a .timer {margin-top:20px; letter-spacing:-2px; color:#444; font-size:30px; text-align:center;}
.status_a {display:none; position:fixed; top:0; left:0; width:100%; padding:14px 0; min-height:26px; line-height:26px; color:#fff; font-size:20px; text-align:center; background:#444;}

.btn_common {display:block; margin:0 auto; width:80%; max-width:300px; height:60px; line-height:60px; color:#fff; font-size:22px; font-weight:bold; text-align:center; background:#bf4be0; cursor:pointer; border:0;}
</style>
</head>
<body>
<!-- start area -->
<div class="start_a">
    <h1><i class="far fa-thumbs-up"></i></i> Up&amp;Down <i class="far fa-thumbs-down"></i> Game</h1>
    <ul>
        <li>선택한 범위 내 무작위로 생성된 숫자를 맞추는 게임입니다.</li>
        <li>게임 방법은 숫자를 입력 후 엔터키, 또는 OK버튼을 클릭해주세요.</li>
        <li>Up메세지는 입력한 숫자보다 정답이 높다는 의미이고, Down메세지는 그 반대입니다.</li>
        <li>적은 횟수로 숫자를 맞히면 더 높은 점수를 획득합니다.</li>
        <li>숫자 범위 선택 후 별칭 입력 후 START버튼을 눌러 시작하세요.</li>
    </ul>
    <select id="term" name="term" class="selectbox">
        <option value="0" selected>숫자 범위를 선택하세요.</option>
        <option value="101">1 ~ 100</option>
        <option value="1001">1 ~ 1,000</option>
        <option value="10001">1 ~ 10,000</option>
    </select>
    <input type="text" id="user_nickname" name="user_nickname" placeholder="별칭을 입력해주세요!">
    <button type="button" class="btn_start btn_common">START</button>
</div>

<!-- game area -->
<div class="game_a">
    <button type="button" title="닫기" class="btn_close"><span></span><span></span></button>
    <div>
        <div class="feed"><i class="far fa-keyboard"></i></div>
        <p class="summary">
            * 숫자를 입력 후 엔터키 또는 OK버튼을 클릭해주세요!
        </p>
        <input type="tel" id="user_pad" name="user_pad" placeholder="input number!" onKeyDown="onEnterKey()">
        <button type="button" id="btn_confirm" class="btn_confirm btn_common">OK</button>
        <p class="timer">
            <span class="m">00</span> :
            <span class="s">00</span> :
            <span class="ms">00</span>
        </p>
    </div>
</div>

<!-- status -->
<div class="status_a"></div>


<script type="text/javascript" src="js/lib/jquery.1.11.1.min.js"></script>
<script type="text/javascript" src="js/lib/jquery-ui-1.10.3.custom.min.js"></script>
<script type="text/javascript" src="js/updown.js"></script>
<script>
var globalStat;
var userInputNumber;
var termNum;
var setNum;
var userName;
var startTime;
var endTime;
var _runTime;
var examDB = localStorage;
var choiceNums = [];
var $termNum = $('#term');
var $userName = $('#user_nickname');
var $userNum = $('#user_pad');
var $btnStart = $('.btn_start');
var $btnClose = $('.btn_close');
var $btnConfirm = $('.btn_confirm');
var $feedBack = $('.feed');
var $gameGuide = $('.summary');
var $statusArea = $('.status_a');
$(document).ready(function(){
    //start버튼 클릭 시 게임 스타트
    $btnStart.on('click', function(){
        startGame();
    });
    //숫자 입력 후 OK버튼 클릭 시
    $btnConfirm.on('click', function(){
        if(globalStat == true){
            gameProcess(setNum);
        }
    });
    //게임 닫기 버튼(X) 클릭 시
    $btnClose.on('click', function(){
        endGame();
        resetGame();
    });
});
//숫자 입력 후 엔터키
function onEnterKey(){
    if(event.keyCode == 13){
        gameProcess(setNum);
    }
}
//게임 시작 화면 노출, 선택한 레벨에 따른 번호 생성
function startGame(level){
    globalStat = true;
    userName = $userName.val();
    termNum = $termNum.val();
    startTime = new Date().getTime();
    if(termNum != 0){
        if(userName == ''){
            showMsgBox('! 사용자 별칭을 입력해주세요.', 5000);
            $userName.focus();
        }else{
            setNum = setNumber(termNum);
            examDB.setItem('term', termNum);
            examDB.setItem('name', userName);
            $('.game_a').animate({'top':0}, 1000, 'easeOutBounce');
            $userNum.focus();
            _runTime = setInterval(runTime, 10);
        }
    }else{
        showMsgBox('! 숫자 범위를 선택해주세요.', 5000);
        $termNum.focus();
    }
}
//게임 종료
function endGame(useCnt){
    choiceNums = [];
    if(useCnt == undefined){
        showMsgBox('게임을 종료합니다.', 5000);
        $('.game_a').animate({'top':'-100%'}, 1000, 'easeOutBounce');
    }else{
        showMsgBox(pointCalculate(examDB.name + '님은 ' + useCnt)[1] + '번의 기회를 사용하여 ' +pointCalculate(useCnt)[0]+ '점을 획득하였습니다.', 15000);
        examDB.point = pointCalculate(useCnt)[0];
        globalStat = false;
    }
}
//게임 종료 시 게임 reset
function resetGame(){
    $feedBack.html('<i class="far fa-keyboard"></i>');
    $gameGuide.text('* 숫자를 입력 후 엔터키 또는 OK버튼을 클릭해주세요!');
    $userNum.removeAttr('disabled').prop({'placeholder':'input number!'});

}
//안내(메시지 전달) 박스 노출
function showMsgBox(msg, delayTime){
    $statusArea.fadeIn().html(msg);
    setTimeout(function(){
        $statusArea.fadeOut().html('');
    }, delayTime);
}
//up , down에 따른 피드백
function upOrDown(state, userInputNumber){
    var awesomeIco, feedMsg;
    var defaultIco = '<i class="far fa-keyboard"></i>';
    if(state == 'up'){
        awesomeIco = '<i class="far fa-thumbs-up"></i>';
        feedMsg = '! ' + userInputNumber + ' 보다 더 높은 숫자를 입력하세요.'
    }else if(state == 'down'){
        awesomeIco = '<i class="far fa-thumbs-down"></i>';
        feedMsg = '! ' + userInputNumber + ' 보다 더 낮은 숫자를 입력하세요.'
    }else{
        awesomeIco = '<i class="fab fa-font-awesome-flag"></i>';
        feedMsg = '! 굉장합니다!'
        $userNum.prop({'disabled':'disabled', 'placeholder':'Awesome!'});
        clearInterval(_runTime);
    }
    $feedBack.html(awesomeIco);
    //$feedBack.delay(1500).html(defaultIco);
    $gameGuide.text(state + feedMsg);
    //$gameGuide.delay(1500).text('* 숫자를 입력 후 엔터키 또는 OK버튼을 클릭해주세요!');
}
//set random number
function setNumber(maxNum){
    var randomNumber = Math.floor(Math.random() * maxNum);
    console.log(randomNumber);
    return randomNumber;
}
//confirm process
function gameProcess(setNumber){
    var msg;
    userInputNumber = $userNum.val();
    if(userInputNumber <= 0 || userInputNumber === undefined || null || NaN){
        $gameGuide.text('1 이상의 숫자를 입력해주세요.');
        return false;
    }
    goOrStop(compareNumber(setNumber, userInputNumber), userInputNumber);
}
//두 숫자를 비교하여 결과(message) return
function compareNumber(setNumber, userNumber){
    var msg;
    if(setNumber == userNumber){
        msg = 'awesome';
    }else if(setNumber < userNumber){
        msg = 'down';
    }else{
        msg = 'up';
    }
    return msg;
}
//메시지를 확인하여 게임 지속/중단 결정 및 feedback
function goOrStop(msg, userInputNumber){
    if(msg == 'awesome'){
        endGame(choiceNums.length+1);
    }else{
        choiceNums.push(userInputNumber);
    }
    $userNum.val('').focus();
    upOrDown(msg, userInputNumber);
}
//점수 반환
function pointCalculate(useCnt){
    return [(100-(useCnt*2)), useCnt];
}
//소요시간 계산
function runTime(){
    endTime = new Date().getTime();
    var strTime = String(startTime - endTime);
    m = Math.floor((((strTime)/(1000*60))%60)*-1);
    s = Math.floor((((strTime)/(1000))%60)*-1);
    ms = String(Math.floor((strTime)*-1)).substring((strTime.length-4),(strTime.length-2));
    $('.m').text(m);
    $('.s').text(s);
    $('.ms').text(ms);
    var playTime = parseInt(m + s + ms);
    examDB.setItem('playTime',playTime)
}
</script>
</body>
</html>
